= MCP Documentation Server - User Manual
:toc: left
:toclevels: 3
:sectnums:
:icons: font
:imagesdir: images

== Introduction

The MCP Documentation Server is a Model Context Protocol (MCP) server that enables efficient interaction with large AsciiDoc and Markdown documentation projects. It provides hierarchical navigation, content search, and direct content manipulation capabilities through a standardized API.

=== Key Features

* **Hierarchical Navigation**: Access document structure without loading entire files
* **Include Resolution**: Automatically resolves AsciiDoc include directives
* **Content Search**: Search across all documentation content with relevance scoring
* **Structured Access**: Get specific sections by path notation
* **Content Manipulation**: Update and insert sections directly in source files
* **File Watching**: Automatic updates when files change
* **Web Interface**: Visual document structure browser
* **Token Efficient**: Only load the content you need

=== System Requirements

* Python 3.8 or higher
* Operating System: Linux, macOS, or Windows
* Memory: Minimum 512MB RAM (scales with document size)
* Storage: Varies based on documentation project size

== Installation and Setup

=== Quick Start

1. **Clone or download the project**
2. **Test the implementation:**
   ```bash
   python3 test_basic.py
   ```
3. **Start the MCP server:**
   ```bash
   ./start_server.sh [project_root]
   ```
4. **Start the web interface (optional):**
   ```bash
   ./start_web.sh [project_root] [port]
   ```

=== Configuration

The server can be configured through command-line arguments or environment variables:

* `PROJECT_ROOT`: Path to the documentation project root
* `MAX_INCLUDE_DEPTH`: Maximum depth for include resolution (default: 4)
* `WEB_PORT`: Port for web interface (default: 8080)

=== MCP Client Integration

Add the server to your MCP client configuration:

```json
{
  "mcpServers": {
    "docs_server": {
      "command": "python3",
      "args": ["src/mcp_server.py", "/path/to/your/docs"],
      "env": {}
    }
  }
}
```

== API Reference

The MCP Documentation Server provides six main tools for interacting with documentation:

=== Navigation Tools

==== get_structure

Retrieves the hierarchical structure of the documentation project.

**Parameters:**
* `max_depth` (optional, integer): Maximum depth to retrieve (default: 3)

**Returns:**
* JSON object with hierarchical document structure
* Each section includes: id, title, level, children_count

**Example:**
```json
{
  "max_depth": 2
}
```

**Response:**
```json
{
  "introduction": {
    "title": "Introduction",
    "level": 1,
    "id": "introduction",
    "children_count": 2,
    "overview": {
      "title": "Overview",
      "level": 2,
      "id": "introduction.overview",
      "children_count": 0
    }
  }
}
```

==== get_section

Retrieves the content of a specific section by its path.

**Parameters:**
* `path` (required, string): Section path using dot notation

**Returns:**
* JSON object with section details: id, title, level, content, children

**Example:**
```json
{
  "path": "introduction.overview"
}
```

**Response:**
```json
{
  "id": "introduction.overview",
  "title": "Overview",
  "level": 2,
  "content": "This section provides an overview...",
  "children": []
}
```

==== get_sections

Retrieves all sections at a specific hierarchical level.

**Parameters:**
* `level` (required, integer): Hierarchical level (1, 2, 3, etc.)

**Returns:**
* Array of section objects at the specified level

**Example:**
```json
{
  "level": 2
}
```

==== search_content

Searches for content across all documentation with relevance scoring.

**Parameters:**
* `query` (required, string): Search query

**Returns:**
* Array of search results with relevance scores and snippets

**Example:**
```json
{
  "query": "installation"
}
```

**Response:**
```json
[
  {
    "id": "getting-started.installation",
    "title": "Installation",
    "relevance": 10,
    "snippet": "Follow these installation steps..."
  }
]
```

=== Content Manipulation Tools

==== update_section

Updates the content of an existing section directly in the source file.

**Parameters:**
* `path` (required, string): Section path using dot notation
* `content` (required, string): New content for the section

**Returns:**
* Success/failure message

**Example:**
```json
{
  "path": "introduction.overview",
  "content": "Updated overview content here."
}
```

**Important Notes:**
* Changes are written directly to source files
* Atomic writes ensure file integrity
* File watchers detect changes automatically

==== insert_section

Inserts a new section relative to an existing section.

**Parameters:**
* `parent_path` (required, string): Path of parent section
* `title` (required, string): Title of new section
* `content` (required, string): Content of new section
* `position` (optional, string): Position relative to parent ("before", "after", "append")

**Returns:**
* Success/failure message

**Example:**
```json
{
  "parent_path": "introduction",
  "title": "New Subsection",
  "content": "Content for the new subsection.",
  "position": "append"
}
```

== Path Notation System

The server uses a hierarchical dot notation system for addressing sections:

=== Path Examples

* `"introduction"` - Top-level section with title "Introduction"
* `"introduction.overview"` - Subsection "Overview" under "Introduction"
* `"getting-started.installation.prerequisites"` - Three-level deep path
* `"1.2.3"` - Numeric section references (if using numbered sections)

=== Path Generation Rules

1. **Title-based**: Section titles are converted to lowercase, kebab-case identifiers
2. **Hierarchical**: Parent-child relationships use dot separation
3. **Unique**: Each path uniquely identifies one section
4. **Stable**: Paths remain consistent across file modifications

== Supported Document Formats

=== AsciiDoc Support

* **File Extensions**: `.adoc`, `.asciidoc`
* **Include Directives**: `include::file.adoc[]` with full resolution
* **Section Levels**: Supports all AsciiDoc heading levels (=, ==, ===, etc.)
* **Attributes**: Basic attribute support for includes

=== Markdown Support

* **File Extensions**: `.md`
* **Section Levels**: Supports all Markdown heading levels (#, ##, ###, etc.)
* **Limited Includes**: Basic include support (implementation-dependent)

=== Include Resolution

The server automatically resolves include directives:

* **Maximum Depth**: 4 levels (configurable)
* **Circular Detection**: Prevents infinite include loops
* **Path Resolution**: Relative and absolute path support
* **Error Handling**: Graceful handling of missing includes

== Web Interface

The optional web interface provides visual navigation of document structure:

=== Features

* **Tree View**: Hierarchical document structure visualization
* **Section Preview**: Click sections to view content
* **Search Interface**: Visual search with result highlighting
* **Real-time Updates**: Reflects file changes automatically

=== Access

* **URL**: `http://localhost:8080` (default)
* **Configuration**: Port configurable via command line
* **Security**: Local access only (no authentication required)

== File Watching and Updates

=== Automatic Detection

The server monitors the file system for changes:

* **File Modifications**: Detects content changes in real-time
* **New Files**: Automatically includes new documentation files
* **Deletions**: Removes deleted files from index
* **Include Updates**: Re-resolves includes when dependencies change

=== Performance Considerations

* **Efficient Monitoring**: Uses OS-native file watching APIs
* **Incremental Updates**: Only re-parses changed files
* **Memory Management**: Maintains reasonable memory usage
* **Debouncing**: Prevents excessive updates during rapid changes

== Troubleshooting

=== Common Issues

==== Server Won't Start

**Symptoms**: Error messages during server startup

**Solutions:**
1. Check Python version (3.8+ required)
2. Verify project path exists and is readable
3. Check for port conflicts (web interface)
4. Review file permissions

==== Include Resolution Fails

**Symptoms**: Missing content from included files

**Solutions:**
1. Verify include paths are correct
2. Check file permissions on included files
3. Ensure include depth doesn't exceed limit
4. Look for circular include dependencies

==== Search Returns No Results

**Symptoms**: Search queries return empty results

**Solutions:**
1. Verify documents are properly parsed
2. Check search query syntax
3. Ensure content exists in indexed files
4. Try broader search terms

==== Content Updates Don't Work

**Symptoms**: update_section or insert_section fail

**Solutions:**
1. Verify section paths are correct
2. Check file write permissions
3. Ensure target files are not locked
4. Validate section hierarchy

=== Debug Mode

Enable debug logging for troubleshooting:

```bash
export DEBUG=1
./start_server.sh /path/to/docs
```

=== Log Files

Check log output for detailed error information:

* **Console Output**: Real-time server messages
* **File Watcher Logs**: File system change notifications
* **Parser Errors**: Document parsing issues

== Performance and Scalability

=== Performance Characteristics

* **Startup Time**: O(n) where n = number of files
* **Memory Usage**: ~1-5MB per 1000 sections (typical)
* **Search Performance**: Sub-second for projects up to 10,000 sections
* **Update Performance**: Near-instant for individual section updates

=== Scalability Limits

* **File Count**: Tested up to 1,000 files
* **Section Count**: Tested up to 10,000 sections
* **File Size**: Individual files up to 10MB
* **Include Depth**: Maximum 4 levels (configurable)

=== Optimization Tips

1. **Structure Documents**: Use reasonable section hierarchies
2. **Limit Includes**: Avoid excessive include nesting
3. **File Organization**: Group related content in directories
4. **Regular Cleanup**: Remove unused files and sections

== Security Considerations

=== File System Access

* **Read Access**: Server requires read access to documentation files
* **Write Access**: Content manipulation requires write permissions
* **Path Traversal**: Built-in protection against directory traversal attacks
* **Sandboxing**: Server operates within specified project directory

=== Network Security

* **Local Only**: Web interface binds to localhost by default
* **No Authentication**: Designed for local development use
* **Plain HTTP**: No HTTPS support (local use assumed)

=== Best Practices

1. **Restrict Access**: Run server in isolated environment
2. **Backup Files**: Maintain backups before content manipulation
3. **Monitor Changes**: Review file modifications regularly
4. **Update Dependencies**: Keep Python and dependencies current

== Advanced Usage

=== Custom Parsers

Extend the system with custom document parsers:

```python
from document_parser import DocumentParser

class CustomParser(DocumentParser):
    def parse_custom_format(self, file_path):
        # Custom parsing logic
        pass
```

=== Integration Examples

==== With Q CLI

```bash
# Add to MCP configuration
q config add-mcp-server docs_server python3 src/mcp_server.py /docs/path
```

==== With Other MCP Clients

```python
import mcp_client

client = mcp_client.Client()
client.connect("docs_server")
structure = client.call_tool("get_structure", {"max_depth": 2})
```

=== Batch Operations

For bulk operations, use the API programmatically:

```python
# Example: Update multiple sections
sections_to_update = [
    ("intro.overview", "New overview content"),
    ("setup.install", "Updated installation steps")
]

for path, content in sections_to_update:
    server.update_section_content(path, content)
```

== Appendix

=== API Error Codes

* **404**: Section not found
* **400**: Invalid parameters
* **500**: Server error
* **403**: Permission denied

=== File Format Support Matrix

[cols="1,1,1,1"]
|===
| Format | Extension | Include Support | Section Levels

| AsciiDoc | .adoc, .asciidoc | Full | Unlimited
| Markdown | .md | Basic | 6 levels
|===

=== Version History

* **1.0**: Initial release with core functionality
* **1.1**: Added web interface and file watching
* **1.2**: Enhanced search with relevance scoring

=== Support and Resources

* **Documentation**: This manual and inline code comments
* **Testing**: Comprehensive test suite included
* **Examples**: Sample projects in test directories
* **Community**: GitHub issues for bug reports and feature requests
