<?xml version='1.0' encoding='US-ASCII' standalone='no'?><svg contentStyleType='text/css' height='860px' preserveAspectRatio='none' style='width:1576px;height:860px;background:#FFFFFF;' version='1.1' viewBox='0 0 1576 860' width='1576px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' zoomAndPan='magnify'><defs/><g><text fill='#000000' font-family='sans-serif' font-size='14' font-weight='bold' lengthAdjust='spacing' textLength='407' x='580.5' y='27.9951'>Sequence Diagram: MCP Protocol Request Handling</text><rect fill='#FFFFFF' height='644.6563' style='stroke:#181818;stroke-width:1.0;' width='10' x='460' y='162.9922'/><rect fill='#FFFFFF' height='586.3906' style='stroke:#181818;stroke-width:1.0;' width='10' x='860' y='192.125'/><rect fill='#FFFFFF' height='214.9297' style='stroke:#181818;stroke-width:1.0;' width='10' x='1134' y='398.9219'/><rect fill='#FFFFFF' height='79.3984' style='stroke:#181818;stroke-width:1.0;' width='10' x='1423' y='428.0547'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='49' x2='49' y1='73.5938' y2='825.6484'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='465' x2='465' y1='73.5938' y2='825.6484'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='865' x2='865' y1='73.5938' y2='825.6484'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1139' x2='1139' y1='73.5938' y2='825.6484'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1427.5' x2='1427.5' y1='73.5938' y2='825.6484'/><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='88' x='5' y='42.2969'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='74' x='12' y='62.292'>MCP Client</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='88' x='5' y='824.6484'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='74' x='12' y='844.6436'>MCP Client</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='114' x='408' y='42.2969'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='100' x='415' y='62.292'>mcp_server.py</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='114' x='408' y='824.6484'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='100' x='415' y='844.6436'>mcp_server.py</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='150' x='790' y='42.2969'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='136' x='797' y='62.292'>protocol_handler.py</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='150' x='790' y='824.6484'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='136' x='797' y='844.6436'>protocol_handler.py</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='132' x='1073' y='42.2969'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='118' x='1080' y='62.292'>document_api.py</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='132' x='1073' y='824.6484'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='118' x='1080' y='844.6436'>document_api.py</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='119' x='1368.5' y='42.2969'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='105' x='1375.5' y='62.292'>Structure Index</text><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='119' x='1368.5' y='824.6484'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='105' x='1375.5' y='844.6436'>Structure Index</text><rect fill='#FFFFFF' height='644.6563' style='stroke:#181818;stroke-width:1.0;' width='10' x='460' y='162.9922'/><rect fill='#FFFFFF' height='586.3906' style='stroke:#181818;stroke-width:1.0;' width='10' x='860' y='192.125'/><rect fill='#FFFFFF' height='214.9297' style='stroke:#181818;stroke-width:1.0;' width='10' x='1134' y='398.9219'/><rect fill='#FFFFFF' height='79.3984' style='stroke:#181818;stroke-width:1.0;' width='10' x='1423' y='428.0547'/><rect fill='#EEEEEE' height='3' style='stroke:#EEEEEE;stroke-width:1.0;' width='1569' x='0' y='104.1602'/><line style='stroke:#000000;stroke-width:1.0;' x1='0' x2='1569' y1='104.1602' y2='104.1602'/><line style='stroke:#000000;stroke-width:1.0;' x1='0' x2='1569' y1='107.1602' y2='107.1602'/><rect fill='#EEEEEE' height='23.1328' style='stroke:#000000;stroke-width:2.0;' width='118' x='725.5' y='93.5938'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='99' x='731.5' y='109.6606'>MCP Request</text><polygon fill='#181818' points='448,158.9922,458,162.9922,448,166.9922,452,162.9922' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;' x1='49' x2='454' y1='162.9922' y2='162.9922'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='115' x='56' y='142.7935'>JSON-RPC request</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='392' x='56' y='157.9263'>{"method": "tools/call", "params": {"name": "get_structure"}}</text><polygon fill='#181818' points='848,188.125,858,192.125,848,196.125,852,192.125' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;' x1='470' x2='854' y1='192.125' y2='192.125'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='371' x='477' y='187.0591'>handle_mcp_request(request, doc_api, webserver, server)</text><line style='stroke:#181818;stroke-width:1.0;' x1='870' x2='912' y1='221.2578' y2='221.2578'/><line style='stroke:#181818;stroke-width:1.0;' x1='912' x2='912' y1='221.2578' y2='234.2578'/><line style='stroke:#181818;stroke-width:1.0;' x1='871' x2='912' y1='234.2578' y2='234.2578'/><polygon fill='#181818' points='881,230.2578,871,234.2578,881,238.2578,877,234.2578' style='stroke:#181818;stroke-width:1.0;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='102' x='877' y='216.1919'>parse JSON-RPC</text><path d='M875,247.2578 L875,287.2578 L1006,287.2578 L1006,257.2578 L996,247.2578 L875,247.2578 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M996,247.2578 L996,257.2578 L1006,257.2578 L996,247.2578 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='110' x='881' y='264.3247'>Validate method,</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='98' x='881' y='279.4575'>extract params</text><line style='stroke:#181818;stroke-width:1.0;' x1='870' x2='912' y1='313.6563' y2='313.6563'/><line style='stroke:#181818;stroke-width:1.0;' x1='912' x2='912' y1='313.6563' y2='326.6563'/><line style='stroke:#181818;stroke-width:1.0;' x1='871' x2='912' y1='326.6563' y2='326.6563'/><polygon fill='#181818' points='881,322.6563,871,326.6563,881,330.6563,877,326.6563' style='stroke:#181818;stroke-width:1.0;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='191' x='877' y='308.5903'>route_to_tool("get_structure")</text><rect fill='#EEEEEE' height='3' style='stroke:#EEEEEE;stroke-width:1.0;' width='1569' x='0' y='355.2227'/><line style='stroke:#000000;stroke-width:1.0;' x1='0' x2='1569' y1='355.2227' y2='355.2227'/><line style='stroke:#000000;stroke-width:1.0;' x1='0' x2='1569' y1='358.2227' y2='358.2227'/><rect fill='#EEEEEE' height='23.1328' style='stroke:#000000;stroke-width:2.0;' width='125' x='722' y='344.6563'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='106' x='728' y='360.7231'>Tool Execution</text><polygon fill='#181818' points='1122,394.9219,1132,398.9219,1122,402.9219,1126,398.9219' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;' x1='870' x2='1128' y1='398.9219' y2='398.9219'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='187' x='877' y='393.856'>get_structure(max_depth=3)</text><polygon fill='#181818' points='1411,424.0547,1421,428.0547,1411,432.0547,1415,428.0547' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;' x1='1144' x2='1417' y1='428.0547' y2='428.0547'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='171' x='1151' y='422.9888'>access self.server.sections</text><path d='M1438,441.0547 L1438,481.0547 L1564,481.0547 L1564,451.0547 L1554,441.0547 L1438,441.0547 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M1554,441.0547 L1554,451.0547 L1564,451.0547 L1554,441.0547 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='105' x='1444' y='458.1216'>Shared state via</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='64' x='1444' y='473.2544'>DI pattern</text><polygon fill='#181818' points='1155,503.4531,1145,507.4531,1155,511.4531,1151,507.4531' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;' x1='1149' x2='1427' y1='507.4531' y2='507.4531'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='80' x='1161' y='502.3872'>sections dict</text><line style='stroke:#181818;stroke-width:1.0;' x1='1144' x2='1186' y1='536.5859' y2='536.5859'/><line style='stroke:#181818;stroke-width:1.0;' x1='1186' x2='1186' y1='536.5859' y2='549.5859'/><line style='stroke:#181818;stroke-width:1.0;' x1='1145' x2='1186' y1='549.5859' y2='549.5859'/><polygon fill='#181818' points='1155,545.5859,1145,549.5859,1155,553.5859,1151,549.5859' style='stroke:#181818;stroke-width:1.0;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='265' x='1151' y='531.52'>_build_hierarchy(sections, max_depth=3)</text><path d='M1149,562.5859 L1149,587.5859 L1314,587.5859 L1314,572.5859 L1304,562.5859 L1149,562.5859 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M1304,562.5859 L1304,572.5859 L1314,572.5859 L1304,562.5859 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='144' x='1155' y='579.6528'>Recursive tree building</text><polygon fill='#181818' points='881,609.8516,871,613.8516,881,617.8516,877,613.8516' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;' x1='875' x2='1138' y1='613.8516' y2='613.8516'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='240' x='887' y='608.7856'>{"chapter-1": {...}, "chapter-2": {...}}</text><rect fill='#EEEEEE' height='3' style='stroke:#EEEEEE;stroke-width:1.0;' width='1569' x='0' y='642.418'/><line style='stroke:#000000;stroke-width:1.0;' x1='0' x2='1569' y1='642.418' y2='642.418'/><line style='stroke:#000000;stroke-width:1.0;' x1='0' x2='1569' y1='645.418' y2='645.418'/><rect fill='#EEEEEE' height='23.1328' style='stroke:#000000;stroke-width:2.0;' width='178' x='695.5' y='631.8516'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='159' x='701.5' y='647.9185'>Response Formatting</text><line style='stroke:#181818;stroke-width:1.0;' x1='870' x2='912' y1='686.1172' y2='686.1172'/><line style='stroke:#181818;stroke-width:1.0;' x1='912' x2='912' y1='686.1172' y2='699.1172'/><line style='stroke:#181818;stroke-width:1.0;' x1='871' x2='912' y1='699.1172' y2='699.1172'/><polygon fill='#181818' points='881,695.1172,871,699.1172,881,703.1172,877,699.1172' style='stroke:#181818;stroke-width:1.0;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='190' x='877' y='681.0513'>format_mcp_response(result)</text><path d='M875,712.1172 L875,752.1172 L1017,752.1172 L1017,722.1172 L1007,712.1172 L875,712.1172 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M1007,712.1172 L1007,722.1172 L1017,722.1172 L1007,712.1172 ' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='113' x='881' y='729.1841'>Wrap in JSON-RPC</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='121' x='881' y='744.3169'>response structure</text><polygon fill='#181818' points='481,774.5156,471,778.5156,481,782.5156,477,778.5156' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;' x1='475' x2='864' y1='778.5156' y2='778.5156'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='200' x='487' y='773.4497'>{"jsonrpc": "2.0", "result": {...}}</text><polygon fill='#181818' points='60,803.6484,50,807.6484,60,811.6484,56,807.6484' style='stroke:#181818;stroke-width:1.0;'/><line style='stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;' x1='54' x2='464' y1='807.6484' y2='807.6484'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='125' x='66' y='802.5825'>JSON-RPC response</text></g></svg>